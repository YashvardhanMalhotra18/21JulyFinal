<?php
session_start();
require 'db.php';

if (!isset($_SESSION['user_id']) || $_SESSION['role'] !== 'admin') {
    header("Location:login.php");
        exit;
        }
        $result = $conn->query("SELECT c.*, u.name FROM complaints c JOIN users u ON c.user_id = u.id ORDER BY c.id DESC");
        ?>
        <!DOCTYPE html>
        <html lang="en" >
        <head>
            <meta charset="UTF-8" />
            <meta name="viewport" content="width=device-width, initial-scale=1" />
              <title>Admin Dashboard - CCMS</title>
                <style>
                    /* Google Fonts */
                        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap');

                            /* Reset */
                                * {
                                      box-sizing: border-box;
                                          }

                                              body {
                                                    font-family: 'Montserrat', sans-serif;
                                                          background: linear-gradient(135deg, #74ebd5 0%, #ACB6E5 100%);
                                                                margin: 0;
                                                                      padding: 0;
                                                                            min-height: 100vh;
                                                                                  color: #333;
                                                                                      }

                                                                                          header {
                                                                                                background: #1e3c72;
                                                                                                      background: linear-gradient(90deg, #2a5298 0%, #1e3c72 100%);
                                                                                                            color: #fff;
                                                                                                                  padding: 25px 40px;
                                                                                                                        display: flex;
                                                                                                                              justify-content: space-between;
                                                                                                                                    align-items: center;
                                                                                                                                          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                                                                                                                                              }
                                                                                                                                                  header h1 {
                                                                                                                                                        margin: 0;
                                                                                                                                                              font-weight: 700;
                                                                                                                                                                    font-size: 28px;
                                                                                                                                                                          letter-spacing: 1.2px;
                                                                                                                                                                                user-select: none;
                                                                                                                                                                                    }
                                                                                                                                                                                        header a.logout-btn {
                                                                                                                                                                                              background-color: #e74c3c;
                                                                                                                                                                                                    color: #fff;
                                                                                                                                                                                                          padding: 12px 24px;
                                                                                                                                                                                                                border-radius: 50px;
                                                                                                                                                                                                                      font-weight: 600;
                                                                                                                                                                                                                            text-decoration: none;
                                                                                                                                                                                                                                  box-shadow: 0 5px 15px rgba(231, 76, 60, 0.6);
                                                                                                                                                                                                                                        transition: background-color 0.3s ease, box-shadow 0.3s ease;
                                                                                                                                                                                                                                              user-select: none;
                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                      header a.logout-btn:hover {
                                                                                                                                                                                                                                                            background-color: #c0392b;
                                                                                                                                                                                                                                                                  box-shadow: 0 8px 20px rgba(192, 57, 43, 0.7);
                                                                                                                                                                                                                                                                      }

                                                                                                                                                                                                                                                                          main {
                                                                                                                                                                                                                                                                                max-width: 1100px;
                                                                                                                                                                                                                                                                                      margin: 40px auto;
                                                                                                                                                                                                                                                                                            background: #fff;
                                                                                                                                                                                                                                                                                                  border-radius: 14px;
                                                                                                                                                                                                                                                                                                        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                                                                                                                                                                                                                                                                                                              padding: 30px;
                                                                                                                                                                                                                                                                                                                    overflow-x: auto;
                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                            table {
                                                                                                                                                                                                                                                                                                                                  width: 100%;
                                                                                                                                                                                                                                                                                                                                        border-collapse: separate;
                                                                                                                                                                                                                                                                                                                                              border-spacing: 0 12px;
                                                                                                                                                                                                                                                                                                                                                    font-size: 16px;
                                                                                                                                                                                                                                                                                                                                                          color: #444;
                                                                                                                                                                                                                                                                                                                                                              }

                                                                                                                                                                                                                                                                                                                                                                  thead th {
                                                                                                                                                                                                                                                                                                                                                                        background: #2a5298;
                                                                                                                                                                                                                                                                                                                                                                              color: #fff;
                                                                                                                                                                                                                                                                                                                                                                                    font-weight: 700;
                                                                                                                                                                                                                                                                                                                                                                                          padding: 14px 20px;
                                                                                                                                                                                                                                                                                                                                                                                                text-transform: uppercase;
                                                                                                                                                                                                                                                                                                                                                                                                      letter-spacing: 0.06em;
                                                                                                                                                                                                                                                                                                                                                                                                            border-radius: 10px 10px 0 0;
                                                                                                                                                                                                                                                                                                                                                                                                                  user-select: none;
                                                                                                                                                                                                                                                                                                                                                                                                                      }

                                                                                                                                                                                                                                                                                                                                                                                                                          tbody tr {
                                                                                                                                                                                                                                                                                                                                                                                                                                background: #f9fafc;
                                                                                                                                                                                                                                                                                                                                                                                                                                      box-shadow: 0 4px 8px rgb(0 0 0 / 0.05);
                                                                                                                                                                                                                                                                                                                                                                                                                                            border-radius: 10px;
                                                                                                                                                                                                                                                                                                                                                                                                                                                  transition: transform 0.15s ease, box-shadow 0.15s ease;
                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                          tbody tr:hover {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                transform: translateY(-3px);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                      box-shadow: 0 8px 20px rgb(0 0 0 / 0.12);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cursor: pointer;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    tbody td {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          padding: 16px 20px;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                vertical-align: middle;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      user-select: text;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              tbody td:first-child {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    font-weight: 600;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          color: #2a5298;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  form select {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        padding: 8px 12px;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              border-radius: 8px;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    border: 1.5px solid #ccc;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          font-size: 15px;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                font-weight: 500;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      color: #333;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            outline: none;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  transition: border-color 0.3s ease;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cursor: pointer;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                form select:focus {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      border-color: #2a5298;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            box-shadow: 0 0 6px rgba(42, 82, 152, 0.4);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    form button {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          background-color: #2a5298;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                color: #fff;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      border: none;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            padding: 9px 18px;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  margin-left: 10px;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        font-weight: 600;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              border-radius: 8px;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cursor: pointer;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          transition: background-color 0.3s ease, box-shadow 0.3s ease;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  form button:hover {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        background-color: #1e3c72;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              box-shadow: 0 5px 15px rgba(30, 60, 114, 0.6);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      /* Responsive */
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          @media (max-width: 768px) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                header {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        flex-direction: column;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                gap: 15px;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            main {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    margin: 20px 15px;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            padding: 20px;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        table {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                font-size: 14px;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            form select, form button {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    font-size: 14px;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            padding: 7px 10px;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          /* No complaints message */
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              .no-complaints {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    text-align: center;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          padding: 40px;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                font-size: 18px;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      color: #666;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            font-style: italic;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  user-select: none;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </style>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </head>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <body>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <header>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <h1>Admin Dashboard</h1>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <a href="logout.php" class="logout-btn" title="Logout">Logout</a>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </header>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <main>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <?php if ($result->num_rows > 0): ?>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <table>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <thead>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <th>ID</th>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <th>User</th>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <th>Category</th>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <th>Subject</th>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <th>Status</th>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <th>Update Status</th>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </thead>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <tbody>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <?php while ($row = $result->fetch_assoc()): ?>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <td><?= htmlspecialchars($row['id']) ?></td>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <td><?= htmlspecialchars($row['name']) ?></td>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <td><?= htmlspecialchars($row['category']) ?></td>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <td><?= htmlspecialchars($row['subject']) ?></td>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <td><?= htmlspecialchars($row['status']) ?></td>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <td>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <form action="update_status.php" method="post" style="display:flex; align-items:center;">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <input type="hidden" name="id" value="<?= htmlspecialchars($row['id']) ?>">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <select name="status" required>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <option value="Pending" <?= $row['status'] === 'Pending' ? 'selected' : '' ?>>Pending</option>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <option value="In Progress" <?= $row['status'] === 'In Progress' ? 'selected' : '' ?>>In Progress</option>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <option value="Resolved" <?= $row['status'] === 'Resolved' ? 'selected' : '' ?>>Resolved</option>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </select>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <button type="submit">Update</button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </form>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </td>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <?php endwhile; ?>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </tbody>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </table>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <?php else: ?>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <p class="no-complaints">No complaints found.</p>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <?php endif; ?>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </main>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </html>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    